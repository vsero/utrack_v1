openapi: 3.0.4
info:
  title: КМТП Universal Tracking - OpenAPI 3.0
  version: v1
  description: |
    **Общая информация**  
    Это сервис отслеживания грузов, проходящих через порт Корсаков.  
    Сервис позволяет получить информацию:  
    * о грузе, об обработке груза, о событиях с грузом
    * о судозаходах, об обработке судозахода, общую статистику по судозаходу
    
    **Об использовании** 
    
    <u>Токен</u>  
    Для выполнения запросов нужен токен доступа, который передается в заголовках ключем `X-Api-Key`. Для упрощения в примерах токен не указан.  
    Свяжитесь со службой поддержки, чтобы получить свой токен.  
    
    <u>Ответы</u>  
    Любой ответ сервиса вернется в обертке [ResponseWrapper](#schema/ResponseWrapper). Для упрощения в примерах обертка не указана.  
    
    <u>Ошибки</u>     
    Информация о любом исключении на стороне сервера (код ответа 500) направляется разработчику автоматически. Если это произошло, попробуйте повторить запрос через пару часов.  
    
    **Контакты**  
    Служба поддержки КМТП:  
    Телефон: +7-962-108-60-85  
    Telegram: +7-962-108-60-85  
    e-mail: operator@kmtp.ru  
    
    Разработчик:  
    Telegram: @VitalySerokurov

  contact:
    name: КМТП 
    email: operator@kmtp.ru
    url: https://kmtp.ru

servers:
  - url: https://kmtp.info/upapi/hs/utrackv1

x-tagGroups:
  - name: Endpoints
    tags:
      - shipment
      - vesselcall
      - Other
  - name: Схема данных
    tags:
      - Shema

tags:
  - name: shipment
    x-displayName: Грузовые отправления
  - name: vesselcall
    x-displayName: Судозаходы
  - name: Other
    x-displayName: Прочее
  - name: Schema


security:
  - ApiKeyAuth: []

paths:
  /ping:
    get:
      tags:
        - Other
      summary: Проверить доступность
      description: Проверка доступности сервиса
      operationId: ping
      responses:
        '200':
          description: Пустой ResponseWrapper
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ResponseWrapper'
  /shipment/search:
    post:
      tags:
        - shipment
      summary: 'Получить списком используя фильтр поиска'
      description: |
        В теле передаются строки для поиска  
        Уточняющие условия, если они нужны, передаются в параметрах
      operationId: Search
      parameters:
        - name: search_by
          in: query
          description: |
            `bl_number` - переданный в body массив является списком номеров коносаментов  
            `label` - переданный в body массив является списком маркировок  
            Для контейнерных грузов маркировка - это номер контейнера   
            Для прочих - произвольная строка, если она была задана при регистрации груза
          required: false
          schema:
            type: string
            enum:
              - bl_number
              - label
            default: label
        - name: cargo_type
          in: query
          description: |
            Фильтр по типу груза: контейнерный или генеральный  
            Важно! Малотоннажные 3 и 5 тонные контейнеры считаются генеральным грузом
          required: false
          schema:
            type: string
            enum:
              - iso_container
              - general
        - name: cargo_flow
          in: query
          description: |
            Фильтр по направлению движения груза: входящий (на сушу) или исходящий (на море)
          required: false
          schema:
            type: string
            enum:
              - inbound
              - outbound
        - name: is_container_unit
          in: query
          description: |
            Фильтр по контейнерным грузам: груз это контейнер или нет
          required: false
          schema:
            type: boolean            
        - name: is_empty_container_unit
          in: query
          description: |
            Фильтр по порожним контейнерам: груз это порожний контейнер или нет
          required: false
          schema:
            type: boolean
        - name: is_finished
          in: query
          description: |
            Фильтр по состоянию обработки: обработка груза в порту завершена или нет
          required: false
          schema:
            type: boolean
      requestBody:
        required: true
        description: |
          Cтроки для поиска  
        content:
          application/json:
            schema:
              type: array
              minItems: 1
              maxItems: 500
              items:
                type: string
            examples:
              search_by_label:
                summary: 'Номера контейнеров (search_by = label)'
                value:
                  - "FITU5542380"
                  - "KUUU6041493"
                  - "WBPU1962467"
              search_by_bl_number:
                summary: 'Номера коносаментов (search_by = bl_number)'
                value:
                  - "ЭД786665"
                  - "ЭЕ011355"
                  - "ЭД669870"
      responses:
        '200':
          description: 'Array из CargoShipment'
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/CargoShipment'
        '400':
          description: Invalid input
        '422':
          description: Validation exception
        '500':
          description: Unexpected error 
        default:
          description: '500 Unexpected error'
      x-codeSamples:
        - lang: 'HTTP'
          label: 'Поиск груженых контейнеров с моря по номерам'
          source: |
            POST /shipment/search?is_empty_container_unit=false&cargo_flow=inbound
            Content-Type: application/json

            [
            "FITU5542380",
            "KUUU6041493",
            "WBPU1962467"
            ]
        - lang: 'HTTP'
          label: 'Поиск по коносаменту'
          source: |
            POST /shipment/search?search_by=bl_number
            Content-Type: application/json

            ["ЭД786665"]
  
  /shipment/batch:
    post:
      tags:
        - shipment
      summary: 'Получить списком по uuid'
      description: 'В теле передается список `uuid` полученных ранее с помощью /search'
      operationId: shipment_batch
      requestBody:
        required: true
        description: 'Массив из uuid'
        content:
          application/json:
            schema:
              type: array
              minItems: 1
              maxItems: 500
              items:
                type: string
                format: uuid
              example:
                - "318f9e91-aed6-11f0-ba8a-a4bf01740731"
                - "7b45182b-b61f-11f0-ba8c-a4bf01740730"                    
      responses:
        '200':
          description: 'Array из CargoShipment'
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/CargoShipment'
        '400':
          description: Invalid input
        '422':
          description: Validation exception
        '500':
          description: Unexpected error
        default:
          description: '500 Unexpected error'
                  
  /shipment/{uuid}:
    get:
      tags:
        - shipment
      summary: 'Получить по uuid'
      description: 'Возвращает одиночный объект CargoShipment по его uuid'
      operationId: shipment_uuid
      parameters:
        - name: uuid
          in: path
          description: uuid CargoShipment
          required: true
          schema:
            type: string
            format: uuid                    
      responses:
        '200':
          description: 'Объект CargoShipment'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CargoShipment'
        '400':
          description: Invalid input
        '422':
          description: Validation exception
        '500':
          description: Unexpected error
        default:
          description: '500 Unexpected error'
      x-codeSamples:
      - lang: 'HTTP'
        label: 'Получить CargoShipment по uuid'
        source: |
          GET /shipment/318f9e91-aed6-11f0-ba8a-a4bf01740731
  
  /vesselcall/batch:
    post:
      tags:
        - vesselcall
      summary: 'Получить списком по uuid'
      description: 'В теле передается список `vessel_call_uuid`'
      operationId: vesselcall_batch
      requestBody:
        required: true
        description: 'Массив из uuid'
        content:
          application/json:
            schema:
              type: array
              minItems: 1
              maxItems: 500
              items:
                type: string
                format: uuid
              example:
                - "c0c13efc-b61e-11f0-ba8c-a4bf01740730"
                - "c2416ccd-a595-11f0-ba8a-a4bf01740731"                    
      responses:
        '200':
          description: 'Array из VesselCall'
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/VesselCall'
        '400':
          description: Invalid input
        '422':
          description: Validation exception
        '500':
          description: Unexpected error
        default:
          description: '500 Unexpected error'
          
  /vesselcall/list:
    get:
      tags:
        - vesselcall
      summary: 'Получить все активные'
      description: 'Возвращает все судозаходы, обработка которых не завершена (под обработкой, на рейде, заявленные)'
      operationId: vesselcall_list                   
      responses:
        '200':
          description: 'Array из VesselCall'
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/VesselCall'
        '400':
          description: Invalid input
        '422':
          description: Validation exception
        '500':
          description: Unexpected error
        default:
          description: '500 Unexpected error'        
  
  /vesselcall/{uuid}:
    get:
      tags:
        - vesselcall
      summary: 'Получить по uuid'
      description: 'Возвращает одиночный объект VesselCall по его uuid'
      operationId: vesselcall_uuid
      parameters:
        - name: uuid
          in: path
          description: vessel_call_uuid
          required: true
          schema:
            type: string
            format: uuid                    
      responses:
        '200':
          description: 'Объект VesselCall'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CargoShipment'
        '400':
          description: Invalid input
        '422':
          description: Validation exception
        '500':
          description: Unexpected error
        default:
          description: '500 Unexpected error'
      x-codeSamples:
      - lang: 'HTTP'
        label: 'Получить CargoShipment по uuid'
        source: |
          GET /shipment/c2416ccd-a595-11f0-ba8a-a4bf01740731
          
          
components:
  schemas:
    
    ResponseWrapper:
      x-swagger-router-model: portup.utrack.model.ResponseWrapper
      type: object
      description: |
        Обертка ответа  
        Любой ответ сервиса вернется в этой обертке
      properties:
        ok:
          type: boolean
          description: true в случае успешного выполнения запроса
          example: true
        result:
          description: |
            В случае успешного выполнения запроса - результат  
            В случае ошибки - string, её описание
          example: {}
   
    CargoShipment:
      x-swagger-router-model: portup.utrack.model.CargoShipment
      type: object
      description: Грузовое отправление
      properties:
        uuid:
          type: string
          format: uuid
          example: '318f9e91-aed6-11f0-ba8a-a4bf01740731'
          description: Уникальный идентификатор грузового отправления
        declared_timestamp:
          type: string
          format: date-time
          example: '2025-10-10T16:08:40+11:00'
          description: Дата регистрации груза в системе
        bl_number:
          type: string
          example: "Сах2545V071KХ2533M"
          description: Номер коносамента
        contents:
          type: string
          example: 'овощи свежие'
          description: Описание груза, содержимого
        label:
          type: string
          example: 'DLTU9018145'
          description: |
            Маркировка груза  
            Для контейнера - его номер  
            Для прочих - произвольная строка, если она была задана при регистрации груза
        title:
          type: string
          example: "DLTU 901 8145 RFHC40' овощи свежие"
          description: 'Рабочее наименование груза'
        is_container_unit:
          type: boolean
          description: Груз это контейнер
        is_empty_container_unit:
          type: boolean
          example: false
          description: Груз это порожний контейнер
        is_customs:
          type: boolean
          example: false
          description: Груз таможенный
        is_dangerous:
          type: boolean
          example: false
          description: Груз опасный
        is_reefer:
          type: boolean
          example: true
          description: Груз это рефрежираторный контейнер
        quantity_unit:
          type: string
          example: 'PCS'
          description: |
            Единица измерения, в которой ведется учет груза  
            Штучные грузы всегда считаются количеством мест (`PCS`)  
            Если груз не делится на места (навалочный, насыпной), то считается по весу в килограммах (`KGS`)  
            Объемные грузы в кубометрах (`CBM`)
          enum:
            - PCS
            - KGS
            - CBM
        total_quantity:
          type: number
          format: decimal
          example: 1
          description: 'Заявленное количество груза, выраженное в `quantity_unit`'
        total_pieces:
          type: integer
          format: int
          example: 1
          description: 'Заявленное количество мест (0 если груз не делится на места)'
        total_weight:
          type: number
          format: decimal
          example: 28700
          description: 'Заявленный вес в килограммах'
        total_volume:
          type: number
          format: decimal
          example: 0
          description: 'Заявленный объем в кубометрах'
        cargo_type:
          type: string
          example: iso_container
          description: 'Тип груза: Контейнерный или Генеральный'
          enum:
            - iso_container
            - general
        container_unit_type:
          type: string
          enum:
            - ISO
            - SMALL
          example: ISO
          description: |
            Идентификатор типа контейнера  
            `ISO` - стандартный морской контейнер  
            `SMALL` - малотоннажный контейнер (3 или 5 тонный) 
        container_unit_size:
          type: integer
          example: 40
          description: |
            Идентификатор типоразмера контейнера  
            10 - морской контейнер 10 футов  
            20 - морской контейнер 20 футов  
            30 - морской контейнер 30 футов  
            40 - морской контейнер 40 футов  
            45 - морской контейнер 45 футов  
            3 - малотоннажный контейнер 3 тонны  
            5 - малотоннажный контейнер 5 тонн
          enum:
            - 10
            - 20
            - 30
            - 40
            - 45
            - 3
            - 5
        cargo_category_code:
          type: string
          example: 'RFHC'
          description: |
            Уникальный код вида груза   
            Для морских контейнеров используются коды ISO
        cargo_category_title:
          type: string
          example: 'Рефконтейнер, высокий'
          description: 'Наименование вида груза' 
        cargo_handling_summary:
          $ref: '#/components/schemas/CargoHandlingSummary'
        cargo_handling_events:
          type: array
          items:
            $ref: '#/components/schemas/CargoHandlingEvent'
          description: |
            События обработки груза
        reefer_events:
          type: array
          items:
            $ref: '#/components/schemas/ReeferEvent'
          description: |
            События обработки рефконтейнера  
            Только для рефконтейнеров (is_reefer = true)'

    CargoHandlingSummary:
      x-swagger-router-model: portup.utrack.model.CargoHandlingSummary
      type: object
      description: 'Сводка по обработке груза'
      properties:
        is_started:
          type: boolean
          description: Обработка груза начата
        is_started_timestamp:
          type: string
          format: date-time
          example: '2025-10-10T16:08:40+11:00'
          description: Дата начала обработки
        is_finished:
          type: boolean
          description: Обработка груза завершена
        is_finished_timestamp:
          type: string
          format: date-time
          example: '2025-10-10T16:08:40+11:00'
          description: Дата окончания обработки
        cargo_flow:
          type: string
          description: 'Направление движения груза: На сушу (`inbound`) или На море (`outbound`)'
          enum:
            - inbound
            - outbound
        transshipment_type:
          type: string
          description: |
            Тип перевалки:  
            Внутрипортовая (`in_port`) - с помещением груза на площадку  
            Прямая (`direct`) - без помещения груза на площадку (перевалка с судна на машину или с машины на судно)
          enum:
            - "in_port"
            - "direct"
        storage_start_timestamp:
          type: string
          format: date-time
          example: '2025-10-10T16:08:40+11:00'
          description: Дата начала хранения
        storage_end_timestamp:
          type: string
          format: date-time
          example: '2025-10-10T16:08:40+11:00'
          description: Дата окончания хранения
        remaining_quantity_vessel:
          type: number
          format: decimal
          example: 0
          description: 'Остаток груза на судне (на момент запроса)'
        remaining_quantity_yard:
          type: number
          format: decimal
          example: 1
          description: 'Остаток груза в порту на хранении (на момент запроса)'
        vessel_call_uuid:
          type: string
          format: uuid
          example: 'c0c13efc-b61e-11f0-ba8c-a4bf01740730'
          description: uuid судозахода
        vessel_call_number:
          type: string
          example: '25129'
          description: |
            Номер судозахода  
            Может быть составным, напр. 2546/2564
        vessel_call_title:
          type: string
          example: '25129 С.ГАВРИЛОВ'
          description: Рабочее наименование судозахода

    CargoHandlingEvent:
      x-swagger-router-model: portup.utrack.model.CargoHandlingEvent
      type: object
      description: 'Событие грузообработки'
      properties:
        event_timestamp:
          type: string
          format: date-time
          example: '2025-10-21T01:00:43+11:00'
          description: Дата события
        cargo_handling_event_type:
          type: string
          example: unloading
          description: |
            Тип события:  
            `unloading` - выгрузка  
            `loading` - погрузка  
            `gate_in` - завоз через КПП  
            `gate_out` - вывоз через КПП  
            `yard_in` - помещение на площадку  
            `yard_out` - снятие с площадки
          enum:
            - unloading
            - loading
            - gate_in
            - gate_out
            - yard_in
            - yard_out
        allocated_quantity:
          type: number
          format: decimal
          example: 1
          description: Количество груза
        cargo_handling_event_location:
          $ref: '#/components/schemas/CargoHandlingEventLocation'

    CargoHandlingEventLocation:
      x-swagger-router-model: portup.utrack.model.CargoHandlingEventLocation
      type: object
      description: |
        Место грузообработки  
        Объект будет содержать <u>только одно</u> свойство
      properties:
        vehicle:
          $ref: '#/components/schemas/Vehicle'
        vessel:
          $ref: '#/components/schemas/Vessel'
        yard:
          $ref: '#/components/schemas/Yard'
        gate:
          $ref: '#/components/schemas/Gate'

    ReeferEvent:
      x-swagger-router-model: portup.utrack.model.ReeferEvent
      type: object
      description: 'Событие обработки рефконтейнера'
      properties:
        event_timestamp:
          type: string
          format: date-time
          example: '2025-10-21T01:00:43+11:00'
          description: Дата события
        reefer_event_type:
          type: string
          example: temperature_check
          description: |
            Тип события:  
            `connection` - подключение  
            `disconnection` - отключение  
            `temperature_check` - контроль температуры  
            `alarm` - тревога, авария  
          enum:
            - connection
            - disconnection
            - temperature_check
            - alarm
        
    Port:
      x-swagger-router-model: portup.utrack.model.Port
      type: object
      description: Порт
      properties:
        uuid:
          type: string
          format: uuid
          example: '101676e1-ed59-11e4-bf39-74d02b359c77'
          description: Уникальный идентификатор
        title:
          type: string
          example: 'Vladivostok'
          description: Наименование
        location_code:
          type: string
          example: 'RUVVO'
          description: Код порта
        country_code:
          type: string
          example: 'RU'
          description: Код страны

    Yard:
      x-swagger-router-model: portup.utrack.model.Yard
      type: object
      description: Площадка хранения груза
      properties:
        title:
          type: string
          example: 'Причал № 6СР'
        terminal_code:
          type: integer
          format: int
          example: 1
          description: 'Уникальный код терминала'
        terminal_title:
          type: string
          example: 'Северный район'
        
    Gate:
      x-swagger-router-model: portup.utrack.model.Gate
      type: object
      description: 'Контрольно-пропускной пункт'
      properties:
        title:
          type: string
          example: 'Северный район'
          description: Наименование
        terminal_code:
          type: integer
          format: int
          example: 1
          description: 'Уникальный код терминала'
        terminal_title:
          type: string
          example: 'Северный район'
          description: Наименование терминала
        
    Vehicle:
      x-swagger-router-model: portup.utrack.model.Vehicle
      type: object
      description: Автотранспорт
      properties:
        title:
          type: string
          example: 'X000XX 65 SITRAK'
          description: Наименование
        plate:
          type: string
          example: 'X000XX 65'
          description: Государственный регистрационный знак
        model:
          type: string
          example: 'SITRAK БЕЛЫЙ'
          description: Модель автомобиля
    
    Vessel:
      x-swagger-router-model: portup.utrack.model.Vessel
      type: object
      description: Судно
      properties:
        uuid:
          type: string
          format: uuid
          example: '8491c51c-f492-11ef-ba81-a4bf01740731'
          description: Уникальный идентификатор
        title:
          type: string
          example: 'К.МАЛАХОВ'
          description: Наименование
        callsign:
          type: string
          example: 'FKDL'
          description: Позывной
    
    VesselCall:
      x-swagger-router-model: portup.utrack.model.VesselCall
      type: object
      description: Судозаход
      properties:
        uuid:
          type: string
          format: uuid
          example: 'c2416ccd-a595-11f0-ba8a-a4bf01740731'
          description: Внутренний уникальный идентификатор
        voyage_number:
          type: string
          example: '2545/2562'
          description: 'Номер рейса / рейсов'
        title:
          type: string
          example: '2545/2562 СИМУШИР'
          description: Наименование
        declared_timestamp:
          type: string
          format: date-time
          example: '2025-10-31T16:10:00+11:00'
          description: Дата регистрации судозахода в системе
        estimated_arrival_date:
          type: string
          format: date-time
          example: '2025-11-11T00:00:00+11:00'
          description: Плановая дата прибытия судна
        port_of_departure:
          $ref: '#/components/schemas/Port'
        port_of_destination:
          $ref: '#/components/schemas/Port'
        vessel:
          $ref: '#/components/schemas/Vessel'
        vessel_handling_summary:
          $ref: '#/components/schemas/VesselHandlingSummary'
        vessel_handling_totals:
          type: array
          items:
            $ref: '#/components/schemas/VesselHandlingTotalsRow'
          description: Таблица итогов обработки судна        
    
    VesselHandlingSummary:
      x-swagger-router-model: portup.utrack.model.VesselHandlingSummary
      type: object
      description: Сводка по обработке судна
      properties:
        start_waiting_timestamp:
          type: string
          format: date-time
          example: '2025-11-12T03:10:00+11:00'
          description: Дата начала ожидания на рейде
        start_unloading_timestamp:
          type: string
          format: date-time
          example: '2025-11-13T14:19:14+11:00'
          description: Дата начала выгрузки
        start_loading_timestamp:
          type: string
          format: date-time
          example: '2025-11-14T14:03:40+11:00'
          description: Дата начала погрузки
        departure_timestamp:
          type: string
          format: date-time
          example: '0001-01-01T00:00:00+00:00'
          description: Дата отхода
        is_finished:
          type: boolean
          example: false
          description: Обработка завершена
        is_finished_timestamp:
          type: string
          format: date-time
          example: '0001-01-01T00:00:00+00:00'
          description: Дата завершения обработки
    
    VesselHandlingTotalsRow:
      x-swagger-router-model: portup.utrack.model.VesselHandlingTotalsRow
      type: object
      description: Строка таблицы итогов обработки судна
      properties:
        vessel_handling_type:
          type: string
          enum: 
            - unloading
            - loading
          example: 'unloading'
          description: Тип обработки судна - выгрузка или погрузка
        cargo_type:
          type: string
          example: iso_container
          description: 'Тип груза: Контейнерный или Генеральный'
          enum:
            - iso_container
            - general  
        is_empty_container_unit:
          type: boolean
          example: false
          description: Груз это порожний контейнер или нет
        declared_pieces:
          type: integer
          format: int
          example: 249
          description: 'Заявленное количество мест'
        declared_weight:
          type: number
          format: decimal
          example: 5098558
          description: 'Заявленный вес в килограммах'
        handled_pieces:
          type: integer
          format: int
          example: 249
          description: 'Обработанное количество мест'
        handled_weight:
          type: number
          format: decimal
          example: 5098558
          description: 'Обработанный вес в килограммах'  
          
  securitySchemes:
    ApiKeyAuth:        
      type: apiKey
      in: header
      name: X-Api-Key
      description: 'Ваш токен доступа'