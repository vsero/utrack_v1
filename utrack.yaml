openapi: 3.0.4
info:
  title: КМТП Universal Tracking - OpenAPI 3.0
  version: v1
  description: |
    **Общая информация**  
    Это сервис отслеживания грузов, проходящих через порт Корсаков.  
    Сервис позволяет получить общую информацию о грузе, об обработке груза, о событиях с грузом.  
    
    **О подключении к сервису**  
    Подключение выполняется с использованием `BasicAuth` по лигину / паролю. Обратитесь в службу поддержки, если вам нужна учетная запись.  
    
    **Об использовании**  
    Любой ответ сервиса вернется в обертке [ResponseWrapper (см. /Ping)](#tag/Other/operation/ping). Для упрощения в примерах обертка не указана.  
    Информация о любом исключении на стороне сервера направляется разработчику автоматически. В свойстве `result` [ResponseWrapper](#tag/Other/operation/ping) вернется номер зарегистрированной ошибки. Обычно такие проблемы решаются в течение часа.  
    
    **Контакты**  
    Служба поддержки КМТП:  
    Телефон: +7-962-108-60-85  
    Telegram: +7-962-108-60-85  
    e-mail: operator@kmtp.ru  
    
    Разработчик:  
    Telegram: @VitalySerokurov

  contact:
    name: КМТП 
    email: operator@kmtp.ru
    url: https://kmtp.ru

servers:
  - url: https://kmtp.info/up/hs/utrackv1

x-tagGroups:
  - name: Отслеживание
    tags:
      - Shipment
      - Other
#  - name: Схемы данных
#    tags:
#      - ResponseWrapper
#      - CargoShipment

tags:
  - name: Shipment
    x-displayName: Грузовые отправления
#    description: Грузовые отправления
  - name: Other
    x-displayName: Прочее
#    description: Прочее
#  - name: CargoShipment
#    description: <SchemaDefinition schemaRef="#/components/schemas/CargoShipment" />
#  - name: ResponseWrapper
#    description: <SchemaDefinition schemaRef="#/components/schemas/ResponseWrapper" />


security:
  - BasicAuth: []

paths:
  /ping:
    get:
      tags:
        - Other
      summary: Проверить доступность
      description: Проверка доступности сервиса
      operationId: ping
      responses:
        '200':
          description: Пустой ResponseWrapper
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ResponseWrapper'
  /shipment/search:
    post:
      tags:
        - Shipment
      summary: 'Получить информацию списком используя фильтр поиска'
      description: |
        В теле передаются строки для поиска  
        Уточняющие условия, если они нужны, передаются в параметрах
      operationId: Search
      parameters:
        - name: search_by
          in: query
          description: |
            `bl_number` - переданный в body массив является списком номеров коносаментов  
            `label` - переданный в body массив является списком маркировок  
            Для контейнерных грузов маркировка - это номер контейнера   
            Для прочих - произвольная строка, если она была задана при регистрации груза
          required: false
          schema:
            type: string
            enum:
              - bl_number
              - label
            default: label
        - name: cargo_type
          in: query
          description: |
            Фильтр по типу груза: контейнерный или генеральный  
            Важно! Малотоннажные 3 и 5 тонные контейнеры (`container_unit_type = SMALL`) считаются генеральным грузом
          required: false
          schema:
            type: string
            enum:
              - container
              - general
        - name: cargo_flow
          in: query
          description: |
            Фильтр по направлению движения груза: входящий (на сушу) или исходящий (на море)
          required: false
          schema:
            type: string
            enum:
              - inbound
              - outbound
        - name: is_container_unit
          in: query
          description: |
            Фильтр по контейнерным грузам: груз это контейнер или нет
          required: false
          schema:
            type: boolean            
        - name: is_empty_container_unit
          in: query
          description: |
            Фильтр по порожним контейнерам: груз это порожний контейнер или нет
          required: false
          schema:
            type: boolean
        - name: is_finished
          in: query
          description: |
            Фильтр по состоянию обработки: обработка груза в порту завершена или нет
          required: false
          schema:
            type: boolean
      requestBody:
        required: true
        description: |
          Cтроки для поиска  
        content:
          application/json:
            schema:
              type: array
              minItems: 1
              maxItems: 500
              items:
                type: string
            examples:
              search_by_label:
                summary: 'Номера контейнеров (search_by = label)'
                value:
                  - "FITU5542380"
                  - "KUUU6041493"
                  - "WBPU1962467"
              search_by_bl_number:
                summary: 'Номера коносаментов (search_by = bl_number)'
                value:
                  - "ЭД786665"
                  - "ЭЕ011355"
                  - "ЭД669870"
      responses:
        '200':
          description: 'Array из CargoShipment'
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/CargoShipment'
        '400':
          description: Invalid input
        '422':
          description: Validation exception
        '500':
          description: Unexpected error 
        default:
          description: '500 Unexpected error'
      x-codeSamples:
        - lang: 'HTTP'
          label: 'Поиск груженых контейнеров с моря по номерам'
          source: |
            POST /shipment/search?is_empty_container_unit=false&cargo_flow=inbound
            Content-Type: application/json

            [
            "FITU5542380",
            "KUUU6041493",
            "WBPU1962467"
            ]
        - lang: 'HTTP'
          label: 'Поиск по коносаменту'
          source: |
            POST /shipment/search?search_by=bl_number
            Content-Type: application/json

            ["ЭД786665"]
  
  /shipment/track:
    post:
      tags:
        - Shipment
      summary: 'Получить информацию списком по uuid'
      description: 'В теле передается список uuid полученных ранее с помощью /search'
      operationId: track
      requestBody:
        required: true
        description: 'Массив uuid для поиска'
        content:
          application/json:
            schema:
              type: array
              minItems: 1
              maxItems: 500
              items:
                type: string
                format: uuid
              example:
                - "3584b2d1-a597-11f0-ba8a-a4bf01740731"
                - "7b45182b-b61f-11f0-ba8c-a4bf01740730"                    
      responses:
        '200':
          description: 'Array из CargoShipment'
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/CargoShipment'
        '400':
          description: Invalid input
        '422':
          description: Validation exception
        '500':
          description: Unexpected error
        default:
          description: '500 Unexpected error'
                  
  /shipment{uuid}:
    get:
      tags:
        - Shipment
      summary: 'Получить информацию по uuid'
      description: 'Возвращает одиночный объект CargoShipment по его uuid'
      operationId: track_by_id
      parameters:
        - name: uuid
          in: path
          description: uuid CargoShipment
          required: true
          schema:
            type: string
            format: uuid                    
      responses:
        '200':
          description: 'Объект CargoShipment'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CargoShipment'
        '400':
          description: Invalid input
        '422':
          description: Validation exception
        '500':
          description: Unexpected error
        default:
          description: '500 Unexpected error'
      x-codeSamples:
      - lang: 'HTTP'
        label: 'Получить CargoShipment по uuid'
        source: |
          GET /shipment/a427bf5e-b5ec-11f0-ba8c-a4bf01740730
  
components:
  schemas:
    
    ResponseWrapper:
      x-swagger-router-model: portup.utrack.model.ResponseWrapper
      type: object
      description: |
        Обертка ответа  
        Любой ответ сервиса вернется в этой обертке
      properties:
        ok:
          type: boolean
          description: true в случае успешного выполнения запроса
          example: true
        result:
          description: |
            В случае успешного выполнения запроса - результат  
            В случае ошибки - string, её описание
          example: {}
   
    CargoShipment:
      x-swagger-router-model: portup.utrack.model.CargoShipment
      type: object
      description: Грузовое отправление
      properties:
        uuid:
          type: string
          format: uuid
          example: '3584b2d1-a597-11f0-ba8a-a4bf01740731'
          description: Внутренний уникальный идентификатор
        declared_timestamp:
          type: string
          format: date-time
          example: '2025-10-10T16:08:40+11:00'
          description: Дата регистрации груза в системе
        cargo_type:
          type: string
          example: container
          description: 'Тип груза: Контейнерный или Генеральный'
          enum:
            - container
            - general
        bl_number:
          type: string
          example: "Сах2545V071KХ2533M"
          description: Номер коносамента
        contents:
          type: string
          example: 'ПЫЛЬ ИНЕРТНАЯ'
          description: Описание груза, содержимого
        label:
          type: string
          example: 'FITU5542380'
          description: |
            Маркировка груза  
            Для контейнера - его номер  
            Для прочих - произвольная строка, если она была задана при регистрации груза
        title:
          type: string
          example: "FITU 554 2380 HC40' ПЫЛЬ ИНЕРТНАЯ"
          description: Рабочее наименование груза в системе
        is_container_unit:
          type: boolean
          description: Груз это контейнер
        is_empty_container_unit:
          type: boolean
          example: false
          description: Груз это порожний контейнер
        is_customs:
          type: boolean
          example: false
          description: Груз таможенный
        is_dangerous:
          type: boolean
          example: false
          description: Груз опасный
        is_reefer:
          type: boolean
          example: false
          description: Груз это рефрежираторный контейнер
        container_unit_type:
          type: string
          enum:
            - ISO
            - SMALL
          example: ISO
          description: |
            Идентификатор типа контейнера  
            `ISO` - стандартный морской контейнер  
            `SMALL` - малотоннажный контейнер (3 или 5 тонный) 
        container_unit_size:
          type: integer
          example: 40
          description: |
            Идентификатор типоразмера контейнера  
            10 - морской контейнер 10 футов  
            20 - морской контейнер 20 футов  
            30 - морской контейнер 30 футов  
            40 - морской контейнер 40 футов  
            45 - морской контейнер 45 футов  
            3 - малотоннажный контейнер 3 тонны  
            5 - малотоннажный контейнер 5 тонн
          enum:
            - 10
            - 20
            - 30
            - 40
            - 45
            - 3
            - 5
        quantity_unit:
          type: string
          example: 'PC'
          description: |
            Единица измерения, в которой ведется учет груза  
            Штучные грузы всегда считаются количеством мест (`PC`)  
            Если груз не делится на места (навалочный, насыпной), то считается по весу в килограммах (`KG`)  
            Объемные грузы в кубометрах (`CM`)
          enum:
            - PC
            - KG
            - CM
        total_quantity:
          type: number
          format: decimal
          example: 1
          description: 'Заявленное количество груза, выраженное в `quantity_unit`'
        total_pieces:
          type: integer
          format: int
          example: 1
          description: 'Заявленное количество мест (0 если груз не делится на места)'
        total_weight:
          type: number
          format: decimal
          example: 28700
          description: 'Заявленный вес в килограммах'
        total_volume:
          type: number
          format: decimal
          example: 0
          description: 'Заявленный объем в кубометрах'
        cargo_category:
          $ref: '#/components/schemas/CargoCategory'
        cargo_handling_summary:
          $ref: '#/components/schemas/CargoHandlingSummary'
        cargo_handling_events:
          type: array
          items:
            $ref: '#/components/schemas/CargoHandlingEvent'
          description: |
            События обработки груза
        reefer_events:
          type: array
          items:
            $ref: '#/components/schemas/ReeferEvent'
          description: |
            События обработки рефконтейнера  
            Только для рефконтейнеров (is_reefer = true)'

    CargoHandlingSummary:
      x-swagger-router-model: portup.utrack.model.CargoHandlingSummary
      type: object
      description: 'Сводные данные об обработке груза'
      properties:
        is_started:
          type: boolean
          description: Обработка груза начата
        is_started_timestamp:
          type: string
          format: date-time
          example: '2025-10-10T16:08:40+11:00'
          description: Дата начала обработки
        is_finished:
          type: boolean
          description: Обработка груза завершена
        is_finished_timestamp:
          type: string
          format: date-time
          example: '2025-10-10T16:08:40+11:00'
          description: Дата окончания обработки
        cargo_flow:
          type: string
          description: "Направление движения груза: На сушу (`inbound`) или На море (`outbound`)"
          enum:
            - inbound
            - outbound
        transshipment_type:
          type: string
          description: |
            Тип перевалки:  
            Внутрипортовая (`in-port`) - с помещением груза на площадку  
            Прямая (`direct`) - без помещения груза на площадку (перевалка с судна на машину или с машины на судно)
          enum:
            - "in-port"
            - "direct"
        storage_start_timestamp:
          type: string
          format: date-time
          example: '2025-10-10T16:08:40+11:00'
          description: Дата начала хранения
        storage_end_timestamp:
          type: string
          format: date-time
          example: '2025-10-10T16:08:40+11:00'
          description: Дата окончания хранения
        remaining_quantity_vessel:
          type: number
          format: decimal
          example: 0
          description: 'Остаток груза на судне (на момент запроса)'
        remaining_quantity_yard:
          type: number
          format: decimal
          example: 1
          description: 'Остаток груза в порту на хранении (на момент запроса)'
        vessel_call:
          $ref: '#/components/schemas/VesselCall'

    CargoHandlingEvent:
      x-swagger-router-model: portup.utrack.model.CargoHandlingEvent
      type: object
      description: 'Событие грузообработки'
      properties:
        event_timestamp:
          type: string
          format: date-time
          example: '2025-10-21T01:00:43+11:00'
          description: Дата события
        cargo_handling_event_type:
          type: string
          example: unloading
          description: |
            Тип события:  
            `unloading` - выгрузка  
            `loading` - погрузка  
            `gate-in` - завоз через КПП  
            `gate-out` - вывоз через КПП  
            `yard-in` - помещение на площадку  
            `yard-out` - снятие с площадки
          enum:
            - unloading
            - loading
            - gate-in
            - gate-out
            - yard-in
            - yard-out
        allocated_quantity:
          type: number
          format: decimal
          example: 1
          description: Количество груза
        cargo_handling_event_location:
          $ref: '#/components/schemas/CargoHandlingEventLocation'

    CargoHandlingEventLocation:
      x-swagger-router-model: portup.utrack.model.CargoHandlingEventLocation
      type: object
      description: |
        Место грузообработки  
        Объект будет содержать только одно из нижеперечисленных свойств
      properties:
        vehicle:
          $ref: '#/components/schemas/Vehicle'
        vessel:
          $ref: '#/components/schemas/Vessel'
        yard:
          $ref: '#/components/schemas/Yard'
        gate:
          $ref: '#/components/schemas/Gate'

    ReeferEvent:
      x-swagger-router-model: portup.utrack.model.ReeferEvent
      type: object
      description: 'Событие обработки рефконтейнера'
      properties:
        event_timestamp:
          type: string
          format: date-time
          example: '2025-10-21T01:00:43+11:00'
          description: Дата события
        reefer_event_type:
          type: string
          example: temperature_check
          description: |
            Тип события:  
            `connection` - подключение  
            `disconnection` - отключение  
            `temperature_check` - контроль температуры  
            `alarm` - тревога, авария  
          enum:
            - connection
            - disconnection
            - temperature_check
            - alarm
        
    VesselCall:
      x-swagger-router-model: portup.utrack.model.VesselCall
      type: object
      description: Судозаход
      properties:
        uuid:
          type: string
          format: uuid
          example: 'c2416ccd-a595-11f0-ba8a-a4bf01740731'
          description: Внутренний уникальный идентификатор
        voyage_number:
          type: string
          example: '2545/2562'
          description: 'Номер рейса / рейсов'
        title:
          type: string
          example: '2545/2562 СИМУШИР'
          description: Наименование
        vessel:
          $ref: '#/components/schemas/Vessel'
        port_of_loading:
          $ref: '#/components/schemas/Port'
        port_of_destination:
          $ref: '#/components/schemas/Port'

    Vessel:
      x-swagger-router-model: portup.utrack.model.Vessel
      type: object
      description: Судно
      properties:
        uuid:
          type: string
          format: uuid
          example: '8491c51c-f492-11ef-ba81-a4bf01740731'
          description: Уникальный идентификатор
        title:
          type: string
          example: 'К.МАЛАХОВ'
          description: Наименование
        callsign:
          type: string
          example: 'FKDL'
          description: Позывной
        
    Port:
      x-swagger-router-model: portup.utrack.model.Port
      type: object
      description: Порт
      properties:
        uuid:
          type: string
          format: uuid
          example: '101676e1-ed59-11e4-bf39-74d02b359c77'
          description: Уникальный идентификатор
        title:
          type: string
          example: 'Vladivostok'
          description: Наименование
        location_code:
          type: string
          example: 'RUVVO'
          description: Код порта
        country_code:
          type: string
          example: 'RU'
          description: Код страны

    Yard:
      x-swagger-router-model: portup.utrack.model.Yard
      type: object
      description: Площадка хранения груза
      properties:
        title:
          type: string
          example: 'Причал № 6СР'
        terminal_code:
          type: integer
          format: int
          example: 1
          description: 'Уникальный код терминала'
        terminal_title:
          type: string
          example: 'Северный район'
        
    Gate:
      x-swagger-router-model: portup.utrack.model.Gate
      type: object
      description: 'Контрольно-пропускной пункт'
      properties:
        title:
          type: string
          example: 'Северный район'
          description: Наименование
        terminal_code:
          type: integer
          format: int
          example: 1
          description: 'Уникальный код терминала'
        terminal_title:
          type: string
          example: 'Северный район'
          description: Наименование терминала
        
    Vehicle:
      x-swagger-router-model: portup.utrack.model.Vehicle
      type: object
      description: Автотранспорт
      properties:
        title:
          type: string
          example: 'X000XX 65 SITRAK'
          description: Наименование
        plate:
          type: string
          example: 'X000XX 65'
          description: Государственный регистрационный знак
        model:
          type: string
          example: 'SITRAK БЕЛЫЙ'
          description: Модель автомобиля

    CargoCategory:
      x-swagger-router-model: portup.utrack.model.CargoCategory
      type: object
      description: Вид груза
      properties:
        code:
          type: string
          example: 'HC'
          description: |
            Уникальный код   
            Для морских контейнеров используются коды ISO
        title:
          type: string
          example: 'Сухой, высокий'
          description: Наименование
       
        
  securitySchemes:
    BasicAuth: # Имя схемы, которое мы используем в блоке security
      type: http
      scheme: basic
      description: |
        Авторизация по стандарту HTTP Basic 
        Передайте логин и пароль в заголовке Authorization